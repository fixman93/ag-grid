{"version":3,"file":"i18next-phrase-in-context-editor-post-processor.js","sources":["../src/phrase.ts"],"sourcesContent":["import '@sagi.io/globalthis';\nimport './typings/global';\nimport './typings/helpers';\nimport { DeepPartial } from './typings/helpers';\nimport { PhraseConfig } from \"./phrase-config.type\";\n\nexport type PhraseInContextEditorOptions = Omit<DeepPartial<PhraseConfig>, 'phraseEnabled' | 'projectId'> & Pick<PhraseConfig, 'phraseEnabled' | 'projectId'>;\n\nexport default class PhraseInContextEditorPostProcessor {\n    private static defaultConfig: Partial<PhraseConfig> = {\n        prefix: '{{__',\n        suffix: '__}}',\n        fullReparse: true,\n        scriptAutoLoad: true\n    };\n    private phraseScript?: HTMLScriptElement;\n\n    static get IN_CONTEXT_EDITOR_SCRIPT_URL () {\n        return `https://phrase.com/assets/in-context-editor/2.0/app.js?${new Date().getTime()}`;\n    }\n\n    static interpolateKey (key: string, prefix: string, suffix: string): string {\n        return prefix + 'phrase_' + key + suffix;\n    }\n\n    static loadInContextEditorScript() {\n        if (typeof window !== 'undefined') {\n            const phraseScript = document.createElement('script');\n            phraseScript.type = 'text/javascript';\n            phraseScript.async = true;\n            phraseScript.src = this.IN_CONTEXT_EDITOR_SCRIPT_URL;\n            const script = document.getElementsByTagName('script')[0];\n            if (script && script.parentNode) {\n                script.parentNode.insertBefore(phraseScript, script);\n            } else {\n                document.body.appendChild(phraseScript);\n            }\n    \n            return phraseScript;\n        }\n    }\n\n    type: 'postProcessor' = 'postProcessor';\n    name = 'phraseInContextEditor';\n\n    constructor (options: PhraseInContextEditorOptions) {\n        this.config = { ...globalThis.PHRASEAPP_CONFIG, ...options } as PhraseConfig;\n        this.phraseEnabled = options.phraseEnabled;\n    }\n\n    interpolateKey (key: string) {\n        return PhraseInContextEditorPostProcessor.interpolateKey(key, this.config.prefix, this.config.suffix);\n    }\n\n    process (value: string, keys: string[], options: unknown, translator: unknown): string {\n        return this.phraseEnabled\n            ? this.interpolateKey(keys[0])\n            : value;\n    }\n\n    set phraseEnabled(phraseEnabled: boolean) {\n        globalThis.PHRASEAPP_ENABLED = phraseEnabled;\n        if (phraseEnabled && this.config.scriptAutoLoad && !this.phraseScript) {\n            this.phraseScript = PhraseInContextEditorPostProcessor.loadInContextEditorScript();\n        }\n    }\n\n    get phraseEnabled() {\n        return globalThis.PHRASEAPP_ENABLED;\n    }\n\n    set config(options: PhraseConfig) {\n        globalThis.PHRASEAPP_CONFIG = { ...PhraseInContextEditorPostProcessor.defaultConfig, ...options };\n    }\n\n    get config() {\n        return globalThis.PHRASEAPP_CONFIG;\n    }\n\n    toScriptHTML () {\n        return `<script>window.PHRASEAPP_ENABLED=true;window.PHRASEAPP_CONFIG=${JSON.stringify(this.config)}</script><script type=\"text/javascript\" async src=\"${PhraseInContextEditorPostProcessor.IN_CONTEXT_EDITOR_SCRIPT_URL}\"></script>`;\n    }\n}\n"],"names":["PhraseInContextEditorPostProcessor","options","this","config","globalThis","PHRASEAPP_CONFIG","phraseEnabled","interpolateKey","key","prefix","suffix","loadInContextEditorScript","window","phraseScript","document","createElement","type","async","src","IN_CONTEXT_EDITOR_SCRIPT_URL","script","getElementsByTagName","parentNode","insertBefore","body","appendChild","process","value","keys","translator","toScriptHTML","JSON","stringify","Date","getTime","PHRASEAPP_ENABLED","scriptAutoLoad","defaultConfig","fullReparse"],"mappings":"wZAQqBA,aAqCjB,WAAaC,GAHbC,UAAwB,gBACxBA,UAAO,wBAGHA,KAAKC,YAAcC,WAAWC,iBAAqBJ,GACnDC,KAAKI,cAAgBL,EAAQK,gBA1B1BC,eAAP,SAAuBC,EAAaC,EAAgBC,GAChD,OAAOD,EAAS,UAAYD,EAAME,KAG/BC,0BAAP,WACI,GAAsB,oBAAXC,OAAwB,CAC/B,IAAMC,EAAeC,SAASC,cAAc,UAC5CF,EAAaG,KAAO,kBACpBH,EAAaI,OAAQ,EACrBJ,EAAaK,IAAMhB,KAAKiB,6BACxB,IAAMC,EAASN,SAASO,qBAAqB,UAAU,GAOvD,OANID,GAAUA,EAAOE,WACjBF,EAAOE,WAAWC,aAAaV,EAAcO,GAE7CN,SAASU,KAAKC,YAAYZ,GAGvBA,qCAYfN,eAAA,SAAgBC,GACZ,OAAOR,EAAmCO,eAAeC,EAAKN,KAAKC,OAAOM,OAAQP,KAAKC,OAAOO,WAGlGgB,QAAA,SAASC,EAAeC,EAAgB3B,EAAkB4B,GACtD,YAAYvB,cACNJ,KAAKK,eAAeqB,EAAK,IACzBD,KAsBVG,aAAA,WACI,uEAAwEC,KAAKC,UAAU9B,KAAKC,+DAA6DH,EAAmCmB,4FA/DhM,WACI,iEAAiE,IAAIc,MAAOC,0CAiDhF,WACI,OAAO9B,WAAW+B,uBARtB,SAAkB7B,GACdF,WAAW+B,kBAAoB7B,EAC3BA,GAAiBJ,KAAKC,OAAOiC,iBAAmBlC,KAAKW,eACrDX,KAAKW,aAAeb,EAAmCW,iDAY/D,WACI,OAAOP,WAAWC,sBALtB,SAAWJ,GACPG,WAAWC,sBAAwBL,EAAmCqC,cAAkBpC,wCA/D7ED,gBAAuC,CAClDS,OAAQ,OACRC,OAAQ,OACR4B,aAAa,EACbF,gBAAgB"}