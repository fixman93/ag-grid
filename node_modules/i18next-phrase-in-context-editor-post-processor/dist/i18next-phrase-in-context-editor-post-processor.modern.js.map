{"version":3,"file":"i18next-phrase-in-context-editor-post-processor.modern.js","sources":["../src/phrase.ts"],"sourcesContent":["import '@sagi.io/globalthis';\nimport './typings/global';\nimport './typings/helpers';\nimport { DeepPartial } from './typings/helpers';\nimport { PhraseConfig } from \"./phrase-config.type\";\n\nexport type PhraseInContextEditorOptions = Omit<DeepPartial<PhraseConfig>, 'phraseEnabled' | 'projectId'> & Pick<PhraseConfig, 'phraseEnabled' | 'projectId'>;\n\nexport default class PhraseInContextEditorPostProcessor {\n    private static defaultConfig: Partial<PhraseConfig> = {\n        prefix: '{{__',\n        suffix: '__}}',\n        fullReparse: true,\n        scriptAutoLoad: true\n    };\n    private phraseScript?: HTMLScriptElement;\n\n    static get IN_CONTEXT_EDITOR_SCRIPT_URL () {\n        return `https://phrase.com/assets/in-context-editor/2.0/app.js?${new Date().getTime()}`;\n    }\n\n    static interpolateKey (key: string, prefix: string, suffix: string): string {\n        return prefix + 'phrase_' + key + suffix;\n    }\n\n    static loadInContextEditorScript() {\n        if (typeof window !== 'undefined') {\n            const phraseScript = document.createElement('script');\n            phraseScript.type = 'text/javascript';\n            phraseScript.async = true;\n            phraseScript.src = this.IN_CONTEXT_EDITOR_SCRIPT_URL;\n            const script = document.getElementsByTagName('script')[0];\n            if (script && script.parentNode) {\n                script.parentNode.insertBefore(phraseScript, script);\n            } else {\n                document.body.appendChild(phraseScript);\n            }\n    \n            return phraseScript;\n        }\n    }\n\n    type: 'postProcessor' = 'postProcessor';\n    name = 'phraseInContextEditor';\n\n    constructor (options: PhraseInContextEditorOptions) {\n        this.config = { ...globalThis.PHRASEAPP_CONFIG, ...options } as PhraseConfig;\n        this.phraseEnabled = options.phraseEnabled;\n    }\n\n    interpolateKey (key: string) {\n        return PhraseInContextEditorPostProcessor.interpolateKey(key, this.config.prefix, this.config.suffix);\n    }\n\n    process (value: string, keys: string[], options: unknown, translator: unknown): string {\n        return this.phraseEnabled\n            ? this.interpolateKey(keys[0])\n            : value;\n    }\n\n    set phraseEnabled(phraseEnabled: boolean) {\n        globalThis.PHRASEAPP_ENABLED = phraseEnabled;\n        if (phraseEnabled && this.config.scriptAutoLoad && !this.phraseScript) {\n            this.phraseScript = PhraseInContextEditorPostProcessor.loadInContextEditorScript();\n        }\n    }\n\n    get phraseEnabled() {\n        return globalThis.PHRASEAPP_ENABLED;\n    }\n\n    set config(options: PhraseConfig) {\n        globalThis.PHRASEAPP_CONFIG = { ...PhraseInContextEditorPostProcessor.defaultConfig, ...options };\n    }\n\n    get config() {\n        return globalThis.PHRASEAPP_CONFIG;\n    }\n\n    toScriptHTML () {\n        return `<script>window.PHRASEAPP_ENABLED=true;window.PHRASEAPP_CONFIG=${JSON.stringify(this.config)}</script><script type=\"text/javascript\" async src=\"${PhraseInContextEditorPostProcessor.IN_CONTEXT_EDITOR_SCRIPT_URL}\"></script>`;\n    }\n}\n"],"names":["PhraseInContextEditorPostProcessor","constructor","options","this","config","globalThis","PHRASEAPP_CONFIG","phraseEnabled","IN_CONTEXT_EDITOR_SCRIPT_URL","Date","getTime","[object Object]","key","prefix","suffix","window","phraseScript","document","createElement","type","async","src","script","getElementsByTagName","parentNode","insertBefore","body","appendChild","interpolateKey","process","value","keys","translator","PHRASEAPP_ENABLED","scriptAutoLoad","loadInContextEditorScript","defaultConfig","toScriptHTML","JSON","stringify","fullReparse"],"mappings":"iPAQqBA,EAqCjBC,YAAaC,GAHbC,UAAwB,gBACxBA,UAAO,wBAGHA,KAAKC,YAAcC,WAAWC,iBAAqBJ,GACnDC,KAAKI,cAAgBL,EAAQK,cA9BMC,0CACnC,iEAAiE,IAAIC,MAAOC,UAG3DC,sBAAEC,EAAaC,EAAgBC,GAChD,OAAOD,EAAS,UAAYD,EAAME,EAGNH,mCAC5B,GAAsB,oBAAXI,OAAwB,CAC/B,MAAMC,EAAeC,SAASC,cAAc,UAC5CF,EAAaG,KAAO,kBACpBH,EAAaI,OAAQ,EACrBJ,EAAaK,IAAMlB,KAAKK,6BACxB,MAAMc,EAASL,SAASM,qBAAqB,UAAU,GAOvD,OANID,GAAUA,EAAOE,WACjBF,EAAOE,WAAWC,aAAaT,EAAcM,GAE7CL,SAASS,KAAKC,YAAYX,GAGvBA,GAYfY,eAAgBhB,GACZ,OAAOZ,EAAmC4B,eAAehB,EAAKT,KAAKC,OAAOS,OAAQV,KAAKC,OAAOU,QAGlGe,QAASC,EAAeC,EAAgB7B,EAAkB8B,GACtD,YAAYzB,cACNJ,KAAKyB,eAAeG,EAAK,IACzBD,EAGOvB,kBAACA,GACdF,WAAW4B,kBAAoB1B,EAC3BA,GAAiBJ,KAAKC,OAAO8B,iBAAmB/B,KAAKa,eACrDb,KAAKa,aAAehB,EAAmCmC,6BAI9C5B,oBACb,OAAOF,WAAW4B,kBAGZ7B,WAACF,GACPG,WAAWC,sBAAwBN,EAAmCoC,cAAkBlC,GAGlFE,aACN,OAAOC,WAAWC,iBAGtB+B,eACI,uEAAwEC,KAAKC,UAAUpC,KAAKC,8DAA6DJ,EAAmCQ,4CAvEjLR,gBAAuC,CAClDa,OAAQ,OACRC,OAAQ,OACR0B,aAAa,EACbN,gBAAgB"}